import{createPlugin as e}from"@fullcalendar/core/index.js";import{config as t,Emitter as i,elementClosest as n,applyStyle as r,whenTransitionDone as s,removeElement as l,ScrollController as o,ElementScrollController as a,computeInnerRect as h,WindowScrollController as c,ElementDragging as g,preventSelection as d,preventContextMenu as u,allowSelection as p,allowContextMenu as v,computeRect as E,getClippingParents as m,pointInsideRect as f,constrainPoint as S,intersectRects as D,getRectCenter as w,diffPoints as y,mapHash as T,rangeContainsRange as M,isDateSpansEqual as b,Interaction as C,interactionSettingsToStore as R,isDateSelectionValid as P,enableCursor as I,disableCursor as x,triggerDateSelect as j,compareNumbers as L,getElSeg as A,getRelevantEvents as H,EventImpl as N,createEmptyEventStore as V,applyMutationToEventStore as Y,isInteractionValid as X,buildEventApis as U,interactionSettingsStore as _,startOfDay as O,diffDates as W,createDuration as q,getEventTargetViaRoot as F,identity as G,eventTupleToStore as k,parseDragMeta as z,elementMatches as B,refineEventDef as Q,parseEventDef as Z,getDefaultEventEnd as $,createEventInstance as J,BASE_OPTION_DEFAULTS as K}from"@fullcalendar/core/internal.js";t.touchMouseIgnoreWait=500;let ee=0;let te=0;let ie=false;class PointerDragging{constructor(e){this.subjectEl=null;this.selector="";this.handleSelector="";this.shouldIgnoreMove=false;this.shouldWatchScroll=true;this.isDragging=false;this.isTouchDragging=false;this.wasTouchScroll=false;this.handleMouseDown=e=>{if(!this.shouldIgnoreMouse()&&isPrimaryMouseButton(e)&&this.tryStart(e)){let t=this.createEventFromMouse(e,true);this.emitter.trigger("pointerdown",t);this.initScrollWatch(t);this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove);document.addEventListener("mouseup",this.handleMouseUp)}};this.handleMouseMove=e=>{let t=this.createEventFromMouse(e);this.recordCoords(t);this.emitter.trigger("pointermove",t)};this.handleMouseUp=e=>{document.removeEventListener("mousemove",this.handleMouseMove);document.removeEventListener("mouseup",this.handleMouseUp);this.emitter.trigger("pointerup",this.createEventFromMouse(e));this.cleanup()};this.handleTouchStart=e=>{if(this.tryStart(e)){this.isTouchDragging=true;let t=this.createEventFromTouch(e,true);this.emitter.trigger("pointerdown",t);this.initScrollWatch(t);let i=e.target;this.shouldIgnoreMove||i.addEventListener("touchmove",this.handleTouchMove);i.addEventListener("touchend",this.handleTouchEnd);i.addEventListener("touchcancel",this.handleTouchEnd);window.addEventListener("scroll",this.handleTouchScroll,true)}};this.handleTouchMove=e=>{let t=this.createEventFromTouch(e);this.recordCoords(t);this.emitter.trigger("pointermove",t)};this.handleTouchEnd=e=>{if(this.isDragging){let t=e.target;t.removeEventListener("touchmove",this.handleTouchMove);t.removeEventListener("touchend",this.handleTouchEnd);t.removeEventListener("touchcancel",this.handleTouchEnd);window.removeEventListener("scroll",this.handleTouchScroll,true);this.emitter.trigger("pointerup",this.createEventFromTouch(e));this.cleanup();this.isTouchDragging=false;startIgnoringMouse()}};this.handleTouchScroll=()=>{this.wasTouchScroll=true};this.handleScroll=e=>{if(!this.shouldIgnoreMove){let t=window.scrollX-this.prevScrollX+this.prevPageX;let i=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:e,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:t,pageY:i,deltaX:t-this.origPageX,deltaY:i-this.origPageY})}};this.containerEl=e;this.emitter=new i;e.addEventListener("mousedown",this.handleMouseDown);e.addEventListener("touchstart",this.handleTouchStart,{passive:true});listenerCreated()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown);this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:true});listenerDestroyed()}tryStart(e){let t=this.querySubjectEl(e);let i=e.target;if(t&&(!this.handleSelector||n(i,this.handleSelector))){this.subjectEl=t;this.isDragging=true;this.wasTouchScroll=false;return true}return false}cleanup(){ie=false;this.isDragging=false;this.subjectEl=null;this.destroyScrollWatch()}querySubjectEl(e){return this.selector?n(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return ee||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(ie=true)}initScrollWatch(e){if(this.shouldWatchScroll){this.recordCoords(e);window.addEventListener("scroll",this.handleScroll,true)}}recordCoords(e){if(this.shouldWatchScroll){this.prevPageX=e.pageX;this.prevPageY=e.pageY;this.prevScrollX=window.scrollX;this.prevScrollY=window.scrollY}}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,true)}createEventFromMouse(e,t){let i=0;let n=0;if(t){this.origPageX=e.pageX;this.origPageY=e.pageY}else{i=e.pageX-this.origPageX;n=e.pageY-this.origPageY}return{origEvent:e,isTouch:false,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:i,deltaY:n}}createEventFromTouch(e,t){let i=e.touches;let n;let r;let s=0;let l=0;if(i&&i.length){n=i[0].pageX;r=i[0].pageY}else{n=e.pageX;r=e.pageY}if(t){this.origPageX=n;this.origPageY=r}else{s=n-this.origPageX;l=r-this.origPageY}return{origEvent:e,isTouch:true,subjectEl:this.subjectEl,pageX:n,pageY:r,deltaX:s,deltaY:l}}}function isPrimaryMouseButton(e){return e.button===0&&!e.ctrlKey}function startIgnoringMouse(){ee+=1;setTimeout((()=>{ee-=1}),t.touchMouseIgnoreWait)}function listenerCreated(){te+=1;te===1&&window.addEventListener("touchmove",onWindowTouchMove,{passive:false})}function listenerDestroyed(){te-=1;te||window.removeEventListener("touchmove",onWindowTouchMove,{passive:false})}function onWindowTouchMove(e){ie&&e.preventDefault()}class ElementMirror{constructor(){this.isVisible=false;this.sourceEl=null;this.mirrorEl=null;this.sourceElRect=null;this.parentNode=document.body;this.zIndex=9999;this.revertDuration=0}start(e,t,i){this.sourceEl=e;this.sourceElRect=this.sourceEl.getBoundingClientRect();this.origScreenX=t-window.scrollX;this.origScreenY=i-window.scrollY;this.deltaX=0;this.deltaY=0;this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX;this.deltaY=t-window.scrollY-this.origScreenY;this.updateElPosition()}setIsVisible(e){if(e){if(!this.isVisible){this.mirrorEl&&(this.mirrorEl.style.display="");this.isVisible=e;this.updateElPosition()}}else if(this.isVisible){this.mirrorEl&&(this.mirrorEl.style.display="none");this.isVisible=e}}stop(e,t){let done=()=>{this.cleanup();t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(done,this.revertDuration):setTimeout(done,0)}doRevertAnimation(e,t){let i=this.mirrorEl;let n=this.sourceEl.getBoundingClientRect();i.style.transition="top "+t+"ms,left "+t+"ms";r(i,{left:n.left,top:n.top});s(i,(()=>{i.style.transition="";e()}))}cleanup(){if(this.mirrorEl){l(this.mirrorEl);this.mirrorEl=null}this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&r(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect;let t=this.mirrorEl;if(!t){t=this.mirrorEl=this.sourceEl.cloneNode(true);t.style.userSelect="none";t.style.webkitUserSelect="none";t.style.pointerEvents="none";t.classList.add("fc-event-dragging");r(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0});this.parentNode.appendChild(t)}return t}}class ScrollGeomCache extends o{constructor(e,t){super();this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop();this.scrollLeft=this.scrollController.getScrollLeft();this.handleScrollChange()};this.scrollController=e;this.doesListening=t;this.scrollTop=this.origScrollTop=e.getScrollTop();this.scrollLeft=this.origScrollLeft=e.getScrollLeft();this.scrollWidth=e.getScrollWidth();this.scrollHeight=e.getScrollHeight();this.clientWidth=e.getClientWidth();this.clientHeight=e.getClientHeight();this.clientRect=this.computeClientRect();this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e);if(!this.doesListening){this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0);this.handleScrollChange()}}setScrollLeft(e){this.scrollController.setScrollLeft(e);if(!this.doesListening){this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0);this.handleScrollChange()}}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}}class ElementScrollGeomCache extends ScrollGeomCache{constructor(e,t){super(new a(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return h(this.scrollController.el)}}class WindowScrollGeomCache extends ScrollGeomCache{constructor(e){super(new c,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}}const ne=typeof performance==="function"?performance.now:Date.now;class AutoScroller{constructor(){this.isEnabled=true;this.scrollQuery=[window,".fc-scroller"];this.edgeThreshold=50;this.maxVelocity=300;this.pointerScreenX=null;this.pointerScreenY=null;this.isAnimating=false;this.scrollCaches=null;this.everMovedUp=false;this.everMovedDown=false;this.everMovedLeft=false;this.everMovedRight=false;this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=ne();this.handleSide(e,(t-this.msSinceRequest)/1e3);this.requestAnimation(t)}else this.isAnimating=false}}}start(e,t,i){if(this.isEnabled){this.scrollCaches=this.buildCaches(i);this.pointerScreenX=null;this.pointerScreenY=null;this.everMovedUp=false;this.everMovedDown=false;this.everMovedLeft=false;this.everMovedRight=false;this.handleMove(e,t)}}handleMove(e,t){if(this.isEnabled){let i=e-window.scrollX;let n=t-window.scrollY;let r=this.pointerScreenY===null?0:n-this.pointerScreenY;let s=this.pointerScreenX===null?0:i-this.pointerScreenX;r<0?this.everMovedUp=true:r>0&&(this.everMovedDown=true);s<0?this.everMovedLeft=true:s>0&&(this.everMovedRight=true);this.pointerScreenX=i;this.pointerScreenY=n;if(!this.isAnimating){this.isAnimating=true;this.requestAnimation(ne())}}}stop(){if(this.isEnabled){this.isAnimating=false;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e;requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:i}=e;let{edgeThreshold:n}=this;let r=n-e.distance;let s=r*r/(n*n)*this.maxVelocity*t;let l=1;switch(e.name){case"left":l=-1;case"right":i.setScrollLeft(i.getScrollLeft()+s*l);break;case"top":l=-1;case"bottom":i.setScrollTop(i.getScrollTop()+s*l);break}}computeBestEdge(e,t){let{edgeThreshold:i}=this;let n=null;let r=this.scrollCaches||[];for(let s of r){let r=s.clientRect;let l=e-r.left;let o=r.right-e;let a=t-r.top;let h=r.bottom-t;if(l>=0&&o>=0&&a>=0&&h>=0){a<=i&&this.everMovedUp&&s.canScrollUp()&&(!n||n.distance>a)&&(n={scrollCache:s,name:"top",distance:a});h<=i&&this.everMovedDown&&s.canScrollDown()&&(!n||n.distance>h)&&(n={scrollCache:s,name:"bottom",distance:h});l<=i&&this.everMovedLeft&&s.canScrollLeft()&&(!n||n.distance>l)&&(n={scrollCache:s,name:"left",distance:l});o<=i&&this.everMovedRight&&s.canScrollRight()&&(!n||n.distance>o)&&(n={scrollCache:s,name:"right",distance:o})}}return n}buildCaches(e){return this.queryScrollEls(e).map((e=>e===window?new WindowScrollGeomCache(false):new ElementScrollGeomCache(e,false)))}queryScrollEls(e){let t=[];for(let i of this.scrollQuery)typeof i==="object"?t.push(i):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(i)));return t}}class FeaturefulElementDragging extends g{constructor(e,t){super(e);this.containerEl=e;this.delay=null;this.minDistance=0;this.touchScrollAllowed=true;this.mirrorNeedsRevert=false;this.isInteracting=false;this.isDragging=false;this.isDelayEnded=false;this.isDistanceSurpassed=false;this.delayTimeoutId=null;this.onPointerDown=e=>{if(!this.isDragging){this.isInteracting=true;this.isDelayEnded=false;this.isDistanceSurpassed=false;d(document.body);u(document.body);e.isTouch||e.origEvent.preventDefault();this.emitter.trigger("pointerdown",e);if(this.isInteracting&&!this.pointer.shouldIgnoreMove){this.mirror.setIsVisible(false);this.mirror.start(e.subjectEl,e.pageX,e.pageY);this.startDelay(e);this.minDistance||this.handleDistanceSurpassed(e)}}};this.onPointerMove=e=>{if(this.isInteracting){this.emitter.trigger("pointermove",e);if(!this.isDistanceSurpassed){let t=this.minDistance;let i;let{deltaX:n,deltaY:r}=e;i=n*n+r*r;i>=t*t&&this.handleDistanceSurpassed(e)}if(this.isDragging){if(e.origEvent.type!=="scroll"){this.mirror.handleMove(e.pageX,e.pageY);this.autoScroller.handleMove(e.pageX,e.pageY)}this.emitter.trigger("dragmove",e)}}};this.onPointerUp=e=>{if(this.isInteracting){this.isInteracting=false;p(document.body);v(document.body);this.emitter.trigger("pointerup",e);if(this.isDragging){this.autoScroller.stop();this.tryStopDrag(e)}if(this.delayTimeoutId){clearTimeout(this.delayTimeoutId);this.delayTimeoutId=null}}};let i=this.pointer=new PointerDragging(e);i.emitter.on("pointerdown",this.onPointerDown);i.emitter.on("pointermove",this.onPointerMove);i.emitter.on("pointerup",this.onPointerUp);t&&(i.selector=t);this.mirror=new ElementMirror;this.autoScroller=new AutoScroller}destroy(){this.pointer.destroy();this.onPointerUp({})}startDelay(e){typeof this.delay==="number"?this.delayTimeoutId=setTimeout((()=>{this.delayTimeoutId=null;this.handleDelayEnd(e)}),this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=true;this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=true;this.tryStartDrag(e)}tryStartDrag(e){if(this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)){this.isDragging=true;this.mirrorNeedsRevert=false;this.autoScroller.start(e.pageX,e.pageY,this.containerEl);this.emitter.trigger("dragstart",e);this.touchScrollAllowed===false&&this.pointer.cancelTouchScroll()}}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=false;this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}}class OffsetTracker{constructor(e){this.el=e;this.origRect=E(e);this.scrollCaches=m(e).map((e=>new ElementScrollGeomCache(e,true)))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let i={left:e,top:t};for(let e of this.scrollCaches)if(!isIgnoredClipping(e.getEventTarget())&&!f(i,e.clientRect))return false;return true}}function isIgnoredClipping(e){let t=e.tagName;return t==="HTML"||t==="BODY"}class HitDragging{constructor(e,t){this.useSubjectCenter=false;this.requireInitial=true;this.disablePointCheck=false;this.initialHit=null;this.movingHit=null;this.finalHit=null;this.handlePointerDown=e=>{let{dragging:t}=this;this.initialHit=null;this.movingHit=null;this.finalHit=null;this.prepareHits();this.processFirstCoord(e);if(this.initialHit||!this.requireInitial){t.setIgnoreMove(false);this.emitter.trigger("pointerdown",e)}else t.setIgnoreMove(true)};this.handleDragStart=e=>{this.emitter.trigger("dragstart",e);this.handleMove(e,true)};this.handleDragMove=e=>{this.emitter.trigger("dragmove",e);this.handleMove(e)};this.handlePointerUp=e=>{this.releaseHits();this.emitter.trigger("pointerup",e)};this.handleDragEnd=e=>{this.movingHit&&this.emitter.trigger("hitupdate",null,true,e);this.finalHit=this.movingHit;this.movingHit=null;this.emitter.trigger("dragend",e)};this.droppableStore=t;e.emitter.on("pointerdown",this.handlePointerDown);e.emitter.on("dragstart",this.handleDragStart);e.emitter.on("dragmove",this.handleDragMove);e.emitter.on("pointerup",this.handlePointerUp);e.emitter.on("dragend",this.handleDragEnd);this.dragging=e;this.emitter=new i}processFirstCoord(e){let t={left:e.pageX,top:e.pageY};let i=t;let n=e.subjectEl;let r;if(n instanceof HTMLElement){r=E(n);i=S(i,r)}let s=this.initialHit=this.queryHitForOffset(i.left,i.top);if(s){if(this.useSubjectCenter&&r){let e=D(r,s.rect);e&&(i=w(e))}this.coordAdjust=y(i,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let i=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);if(t||!isHitsEqual(this.movingHit,i)){this.movingHit=i;this.emitter.trigger("hitupdate",i,false,e)}}prepareHits(){this.offsetTrackers=T(this.droppableStore,(e=>{e.component.prepareHits();return new OffsetTracker(e.el)}))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:i,offsetTrackers:n}=this;let r=null;for(let s in i){let l=i[s].component;let o=n[s];if(o&&o.isWithinClipping(e,t)){let i=o.computeLeft();let n=o.computeTop();let a=e-i;let h=t-n;let{origRect:c}=o;let g=c.right-c.left;let d=c.bottom-c.top;if(a>=0&&a<g&&h>=0&&h<d){let e=l.queryHit(a,h,g,d);if(e&&M(e.dateProfile.activeRange,e.dateSpan.range)&&(this.disablePointCheck||o.el.contains(o.el.getRootNode().elementFromPoint(a+i-window.scrollX,h+n-window.scrollY)))&&(!r||e.layer>r.layer)){e.componentId=s;e.context=l.context;e.rect.left+=i;e.rect.right+=i;e.rect.top+=n;e.rect.bottom+=n;r=e}}}}return r}}function isHitsEqual(e,t){return!e&&!t||Boolean(e)===Boolean(t)&&b(e.dateSpan,t.dateSpan)}function buildDatePointApiWithContext(e,t){let i={};for(let n of t.pluginHooks.datePointTransforms)Object.assign(i,n(e,t));Object.assign(i,buildDatePointApi(e,t.dateEnv));return i}function buildDatePointApi(e,t){return{date:t.toDate(e.range.start),dateStr:t.formatIso(e.range.start,{omitTime:e.allDay}),allDay:e.allDay}}class DateClicking extends C{constructor(e){super(e);this.handlePointerDown=e=>{let{dragging:t}=this;let i=e.origEvent.target;t.setIgnoreMove(!this.component.isValidDateDownEl(i))};this.handleDragEnd=e=>{let{component:t}=this;let{pointer:i}=this.dragging;if(!i.wasTouchScroll){let{initialHit:i,finalHit:n}=this.hitDragging;if(i&&n&&isHitsEqual(i,n)){let{context:n}=t;let r=Object.assign(Object.assign({},buildDatePointApiWithContext(i.dateSpan,n)),{dayEl:i.dayEl,jsEvent:e.origEvent,view:n.viewApi||n.calendarApi.view});n.emitter.trigger("dateClick",r)}}};this.dragging=new FeaturefulElementDragging(e.el);this.dragging.autoScroller.isEnabled=false;let t=this.hitDragging=new HitDragging(this.dragging,R(e));t.emitter.on("pointerdown",this.handlePointerDown);t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}}class DateSelecting extends C{constructor(e){super(e);this.dragSelection=null;this.handlePointerDown=e=>{let{component:t,dragging:i}=this;let{options:n}=t.context;let r=n.selectable&&t.isValidDateDownEl(e.origEvent.target);i.setIgnoreMove(!r);i.delay=e.isTouch?getComponentTouchDelay$1(t):null};this.handleDragStart=e=>{this.component.context.calendarApi.unselect(e)};this.handleHitUpdate=(e,t)=>{let{context:i}=this.component;let n=null;let r=false;if(e){let t=this.hitDragging.initialHit;let s=e.componentId===t.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(t,e);s||(n=joinHitsIntoSelection(t,e,i.pluginHooks.dateSelectionTransformers));if(!n||!P(n,e.dateProfile,i)){r=true;n=null}}n?i.dispatch({type:"SELECT_DATES",selection:n}):t||i.dispatch({type:"UNSELECT_DATES"});r?x():I();t||(this.dragSelection=n)};this.handlePointerUp=e=>{if(this.dragSelection){j(this.dragSelection,e,this.component.context);this.dragSelection=null}};let{component:t}=e;let{options:i}=t.context;let n=this.dragging=new FeaturefulElementDragging(e.el);n.touchScrollAllowed=false;n.minDistance=i.selectMinDistance||0;n.autoScroller.isEnabled=i.dragScroll;let r=this.hitDragging=new HitDragging(this.dragging,R(e));r.emitter.on("pointerdown",this.handlePointerDown);r.emitter.on("dragstart",this.handleDragStart);r.emitter.on("hitupdate",this.handleHitUpdate);r.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}}function getComponentTouchDelay$1(e){let{options:t}=e.context;let i=t.selectLongPressDelay;i==null&&(i=t.longPressDelay);return i}function joinHitsIntoSelection(e,t,i){let n=e.dateSpan;let r=t.dateSpan;let s=[n.range.start,n.range.end,r.range.start,r.range.end];s.sort(L);let l={};for(let n of i){let i=n(e,t);if(i===false)return null;i&&Object.assign(l,i)}l.range={start:s[0],end:s[3]};l.allDay=n.allDay;return l}class EventDragging extends C{constructor(e){super(e);this.subjectEl=null;this.subjectSeg=null;this.isDragging=false;this.eventRange=null;this.relevantEvents=null;this.receivingContext=null;this.validMutation=null;this.mutatedRelevantEvents=null;this.handlePointerDown=e=>{let t=e.origEvent.target;let{component:i,dragging:r}=this;let{mirror:s}=r;let{options:l}=i.context;let o=i.context;this.subjectEl=e.subjectEl;let a=this.subjectSeg=A(e.subjectEl);let h=this.eventRange=a.eventRange;let c=h.instance.instanceId;this.relevantEvents=H(o.getCurrentData().eventStore,c);r.minDistance=e.isTouch?0:l.eventDragMinDistance;r.delay=e.isTouch&&c!==i.props.eventSelection?getComponentTouchDelay(i):null;l.fixedMirrorParent?s.parentNode=l.fixedMirrorParent:s.parentNode=n(t,".fc");s.revertDuration=l.dragRevertDuration;let g=i.isValidSegDownEl(t)&&!n(t,".fc-event-resizer");r.setIgnoreMove(!g);this.isDragging=g&&e.subjectEl.classList.contains("fc-event-draggable")};this.handleDragStart=e=>{let t=this.component.context;let i=this.eventRange;let n=i.instance.instanceId;e.isTouch?n!==this.component.props.eventSelection&&t.dispatch({type:"SELECT_EVENT",eventInstanceId:n}):t.dispatch({type:"UNSELECT_EVENT"});if(this.isDragging){t.calendarApi.unselect(e);t.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new N(t,i.def,i.instance),jsEvent:e.origEvent,view:t.viewApi})}};this.handleHitUpdate=(e,t)=>{if(!this.isDragging)return;let i=this.relevantEvents;let n=this.hitDragging.initialHit;let r=this.component.context;let s=null;let l=null;let o=null;let a=false;let h={affectedEvents:i,mutatedEvents:V(),isEvent:true};if(e){s=e.context;let t=s.options;if(r===s||t.editable&&t.droppable){l=computeEventMutation(n,e,this.eventRange.instance.range.start,s.getCurrentData().pluginHooks.eventDragMutationMassagers);if(l){o=Y(i,s.getCurrentData().eventUiBases,l,s);h.mutatedEvents=o;if(!X(h,e.dateProfile,s)){a=true;l=null;o=null;h.mutatedEvents=V()}}}else s=null}this.displayDrag(s,h);a?x():I();if(!t){r===s&&isHitsEqual(n,e)&&(l=null);this.dragging.setMirrorNeedsRevert(!l);this.dragging.setMirrorIsVisible(!e||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror"));this.receivingContext=s;this.validMutation=l;this.mutatedRelevantEvents=o}};this.handlePointerUp=()=>{this.isDragging||this.cleanup()};this.handleDragEnd=e=>{if(this.isDragging){let t=this.component.context;let i=t.viewApi;let{receivingContext:n,validMutation:r}=this;let s=this.eventRange.def;let l=this.eventRange.instance;let o=new N(t,s,l);let a=this.relevantEvents;let h=this.mutatedRelevantEvents;let{finalHit:c}=this.hitDragging;this.clearDrag();t.emitter.trigger("eventDragStop",{el:this.subjectEl,event:o,jsEvent:e.origEvent,view:i});if(r){if(n===t){let n=new N(t,h.defs[s.defId],l?h.instances[l.instanceId]:null);t.dispatch({type:"MERGE_EVENTS",eventStore:h});let c={oldEvent:o,event:n,relatedEvents:U(h,t,l),revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:a})}};let g={};for(let e of t.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(g,e(r,t));t.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},c),g),{el:e.subjectEl,delta:r.datesDelta,jsEvent:e.origEvent,view:i}));t.emitter.trigger("eventChange",c)}else if(n){let r={event:o,relatedEvents:U(a,t,l),revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:a})}};t.emitter.trigger("eventLeave",Object.assign(Object.assign({},r),{draggedEl:e.subjectEl,view:i}));t.dispatch({type:"REMOVE_EVENTS",eventStore:a});t.emitter.trigger("eventRemove",r);let g=h.defs[s.defId];let d=h.instances[l.instanceId];let u=new N(n,g,d);n.dispatch({type:"MERGE_EVENTS",eventStore:h});let p={event:u,relatedEvents:U(h,n,d),revert(){n.dispatch({type:"REMOVE_EVENTS",eventStore:h})}};n.emitter.trigger("eventAdd",p);e.isTouch&&n.dispatch({type:"SELECT_EVENT",eventInstanceId:l.instanceId});n.emitter.trigger("drop",Object.assign(Object.assign({},buildDatePointApiWithContext(c.dateSpan,n)),{draggedEl:e.subjectEl,jsEvent:e.origEvent,view:c.context.viewApi}));n.emitter.trigger("eventReceive",Object.assign(Object.assign({},p),{draggedEl:e.subjectEl,view:c.context.viewApi}))}}else t.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this;let{options:i}=t.context;let r=this.dragging=new FeaturefulElementDragging(e.el);r.pointer.selector=EventDragging.SELECTOR;r.touchScrollAllowed=false;r.autoScroller.isEnabled=i.dragScroll;let s=this.hitDragging=new HitDragging(this.dragging,_);s.useSubjectCenter=e.useEventCenter;s.emitter.on("pointerdown",this.handlePointerDown);s.emitter.on("dragstart",this.handleDragStart);s.emitter.on("hitupdate",this.handleHitUpdate);s.emitter.on("pointerup",this.handlePointerUp);s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let i=this.component.context;let n=this.receivingContext;n&&n!==e&&(n===i?n.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:V(),isEvent:true}}):n.dispatch({type:"UNSET_EVENT_DRAG"}));e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context;let{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"});e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null;this.isDragging=false;this.eventRange=null;this.relevantEvents=null;this.receivingContext=null;this.validMutation=null;this.mutatedRelevantEvents=null}}EventDragging.SELECTOR=".fc-event-draggable, .fc-event-resizable";function computeEventMutation(e,t,i,n){let r=e.dateSpan;let s=t.dateSpan;let l=r.range.start;let o=s.range.start;let a={};if(r.allDay!==s.allDay){a.allDay=s.allDay;a.hasEnd=t.context.options.allDayMaintainDuration;l=s.allDay?O(i):i}let h=W(l,o,e.context.dateEnv,e.componentId===t.componentId?e.largeUnit:null);h.milliseconds&&(a.allDay=false);let c={datesDelta:h,standardProps:a};for(let i of n)i(c,e,t);return c}function getComponentTouchDelay(e){let{options:t}=e.context;let i=t.eventLongPressDelay;i==null&&(i=t.longPressDelay);return i}class EventResizing extends C{constructor(e){super(e);this.draggingSegEl=null;this.draggingSeg=null;this.eventRange=null;this.relevantEvents=null;this.validMutation=null;this.mutatedRelevantEvents=null;this.handlePointerDown=e=>{let{component:t}=this;let i=this.querySegEl(e);let n=A(i);let r=this.eventRange=n.eventRange;this.dragging.minDistance=t.context.options.eventDragMinDistance;this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(e.origEvent.target)||e.isTouch&&this.component.props.eventSelection!==r.instance.instanceId)};this.handleDragStart=e=>{let{context:t}=this.component;let i=this.eventRange;this.relevantEvents=H(t.getCurrentData().eventStore,this.eventRange.instance.instanceId);let n=this.querySegEl(e);this.draggingSegEl=n;this.draggingSeg=A(n);t.calendarApi.unselect();t.emitter.trigger("eventResizeStart",{el:n,event:new N(t,i.def,i.instance),jsEvent:e.origEvent,view:t.viewApi})};this.handleHitUpdate=(e,t,i)=>{let{context:n}=this.component;let r=this.relevantEvents;let s=this.hitDragging.initialHit;let l=this.eventRange.instance;let o=null;let a=null;let h=false;let c={affectedEvents:r,mutatedEvents:V(),isEvent:true};if(e){let t=e.componentId===s.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(s,e);t||(o=computeMutation(s,e,i.subjectEl.classList.contains("fc-event-resizer-start"),l.range))}if(o){a=Y(r,n.getCurrentData().eventUiBases,o,n);c.mutatedEvents=a;if(!X(c,e.dateProfile,n)){h=true;o=null;a=null;c.mutatedEvents=null}}a?n.dispatch({type:"SET_EVENT_RESIZE",state:c}):n.dispatch({type:"UNSET_EVENT_RESIZE"});h?x():I();if(!t){o&&isHitsEqual(s,e)&&(o=null);this.validMutation=o;this.mutatedRelevantEvents=a}};this.handleDragEnd=e=>{let{context:t}=this.component;let i=this.eventRange.def;let n=this.eventRange.instance;let r=new N(t,i,n);let s=this.relevantEvents;let l=this.mutatedRelevantEvents;t.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:r,jsEvent:e.origEvent,view:t.viewApi});if(this.validMutation){let o=new N(t,l.defs[i.defId],n?l.instances[n.instanceId]:null);t.dispatch({type:"MERGE_EVENTS",eventStore:l});let a={oldEvent:r,event:o,relatedEvents:U(l,t,n),revert(){t.dispatch({type:"MERGE_EVENTS",eventStore:s})}};t.emitter.trigger("eventResize",Object.assign(Object.assign({},a),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||q(0),endDelta:this.validMutation.endDelta||q(0),jsEvent:e.origEvent,view:t.viewApi}));t.emitter.trigger("eventChange",a)}else t.emitter.trigger("_noEventResize");this.draggingSeg=null;this.relevantEvents=null;this.validMutation=null};let{component:t}=e;let i=this.dragging=new FeaturefulElementDragging(e.el);i.pointer.selector=".fc-event-resizer";i.touchScrollAllowed=false;i.autoScroller.isEnabled=t.context.options.dragScroll;let n=this.hitDragging=new HitDragging(this.dragging,R(e));n.emitter.on("pointerdown",this.handlePointerDown);n.emitter.on("dragstart",this.handleDragStart);n.emitter.on("hitupdate",this.handleHitUpdate);n.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return n(e.subjectEl,".fc-event")}}function computeMutation(e,t,i,n){let r=e.context.dateEnv;let s=e.dateSpan.range.start;let l=t.dateSpan.range.start;let o=W(s,l,r,e.largeUnit);if(i){if(r.add(n.start,o)<n.end)return{startDelta:o}}else if(r.add(n.end,o)>n.start)return{endDelta:o};return null}class UnselectAuto{constructor(e){this.context=e;this.isRecentPointerDateSelect=false;this.matchesCancel=false;this.matchesEvent=false;this.onSelect=e=>{e.jsEvent&&(this.isRecentPointerDateSelect=true)};this.onDocumentPointerDown=e=>{let t=this.context.options.unselectCancel;let i=F(e.origEvent);this.matchesCancel=!!n(i,t);this.matchesEvent=!!n(i,EventDragging.SELECTOR)};this.onDocumentPointerUp=e=>{let{context:t}=this;let{documentPointer:i}=this;let n=t.getCurrentData();if(!i.wasTouchScroll){if(n.dateSelection&&!this.isRecentPointerDateSelect){let i=t.options.unselectAuto;!i||i&&this.matchesCancel||t.calendarApi.unselect(e)}n.eventSelection&&!this.matchesEvent&&t.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=false};let t=this.documentPointer=new PointerDragging(document);t.shouldIgnoreMove=true;t.shouldWatchScroll=false;t.emitter.on("pointerdown",this.onDocumentPointerDown);t.emitter.on("pointerup",this.onDocumentPointerUp);e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect);this.documentPointer.destroy()}}const re={fixedMirrorParent:G};const se={dateClick:G,eventDragStart:G,eventDragStop:G,eventDrop:G,eventResizeStart:G,eventResizeStop:G,eventResize:G,drop:G,eventReceive:G,eventLeave:G};class ExternalElementDragging{constructor(e,t){this.receivingContext=null;this.droppableEvent=null;this.suppliedDragMeta=null;this.dragMeta=null;this.handleDragStart=e=>{this.dragMeta=this.buildDragMeta(e.subjectEl)};this.handleHitUpdate=(e,t,i)=>{let{dragging:n}=this.hitDragging;let r=null;let s=null;let l=false;let o={affectedEvents:V(),mutatedEvents:V(),isEvent:this.dragMeta.create};if(e){r=e.context;if(this.canDropElOnCalendar(i.subjectEl,r)){s=computeEventForDateSpan(e.dateSpan,this.dragMeta,r);o.mutatedEvents=k(s);l=!X(o,e.dateProfile,r);if(l){o.mutatedEvents=V();s=null}}}this.displayDrag(r,o);n.setMirrorIsVisible(t||!s||!document.querySelector(".fc-event-mirror"));l?x():I();if(!t){n.setMirrorNeedsRevert(!s);this.receivingContext=r;this.droppableEvent=s}};this.handleDragEnd=e=>{let{receivingContext:t,droppableEvent:i}=this;this.clearDrag();if(t&&i){let n=this.hitDragging.finalHit;let r=n.context.viewApi;let s=this.dragMeta;t.emitter.trigger("drop",Object.assign(Object.assign({},buildDatePointApiWithContext(n.dateSpan,t)),{draggedEl:e.subjectEl,jsEvent:e.origEvent,view:r}));if(s.create){let n=k(i);t.dispatch({type:"MERGE_EVENTS",eventStore:n});e.isTouch&&t.dispatch({type:"SELECT_EVENT",eventInstanceId:i.instance.instanceId});t.emitter.trigger("eventReceive",{event:new N(t,i.def,i.instance),relatedEvents:[],revert(){t.dispatch({type:"REMOVE_EVENTS",eventStore:n})},draggedEl:e.subjectEl,view:r})}}this.receivingContext=null;this.droppableEvent=null};let i=this.hitDragging=new HitDragging(e,_);i.requireInitial=false;i.emitter.on("dragstart",this.handleDragStart);i.emitter.on("hitupdate",this.handleHitUpdate);i.emitter.on("dragend",this.handleDragEnd);this.suppliedDragMeta=t}buildDragMeta(e){return typeof this.suppliedDragMeta==="object"?z(this.suppliedDragMeta):typeof this.suppliedDragMeta==="function"?z(this.suppliedDragMeta(e)):getDragMetaFromEl(e)}displayDrag(e,t){let i=this.receivingContext;i&&i!==e&&i.dispatch({type:"UNSET_EVENT_DRAG"});e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){this.receivingContext&&this.receivingContext.dispatch({type:"UNSET_EVENT_DRAG"})}canDropElOnCalendar(e,t){let i=t.options.dropAccept;return typeof i==="function"?i.call(t.calendarApi,e):typeof i!=="string"||!i||Boolean(B(e,i))}}function computeEventForDateSpan(e,t,i){let n=Object.assign({},t.leftoverProps);for(let r of i.pluginHooks.externalDefTransforms)Object.assign(n,r(e,t));let{refined:r,extra:s}=Q(n,i);let l=Z(r,s,t.sourceId,e.allDay,i.options.forceEventDuration||Boolean(t.duration),i);let o=e.range.start;e.allDay&&t.startTime&&(o=i.dateEnv.add(o,t.startTime));let a=t.duration?i.dateEnv.add(o,t.duration):$(e.allDay,o,i);let h=J(l.defId,{start:o,end:a});return{def:l,instance:h}}function getDragMetaFromEl(e){let t=getEmbeddedElData(e,"event");let i=t?JSON.parse(t):{create:false};return z(i)}t.dataAttrPrefix="";function getEmbeddedElData(e,i){let n=t.dataAttrPrefix;let r=(n?n+"-":"")+i;return e.getAttribute("data-"+r)||""}class ExternalDraggable{constructor(e,t={}){this.handlePointerDown=e=>{let{dragging:t}=this;let{minDistance:i,longPressDelay:n}=this.settings;t.minDistance=i!=null?i:e.isTouch?0:K.eventDragMinDistance;t.delay=e.isTouch?n!=null?n:K.longPressDelay:0};this.handleDragStart=e=>{e.isTouch&&this.dragging.delay&&e.subjectEl.classList.contains("fc-event")&&this.dragging.mirror.getMirrorEl().classList.add("fc-event-selected")};this.settings=t;let i=this.dragging=new FeaturefulElementDragging(e);i.touchScrollAllowed=false;t.itemSelector!=null&&(i.pointer.selector=t.itemSelector);t.appendTo!=null&&(i.mirror.parentNode=t.appendTo);i.emitter.on("pointerdown",this.handlePointerDown);i.emitter.on("dragstart",this.handleDragStart);new ExternalElementDragging(i,t.eventData)}destroy(){this.dragging.destroy()}}class InferredElementDragging extends g{constructor(e){super(e);this.shouldIgnoreMove=false;this.mirrorSelector="";this.currentMirrorEl=null;this.handlePointerDown=e=>{this.emitter.trigger("pointerdown",e);this.shouldIgnoreMove||this.emitter.trigger("dragstart",e)};this.handlePointerMove=e=>{this.shouldIgnoreMove||this.emitter.trigger("dragmove",e)};this.handlePointerUp=e=>{this.emitter.trigger("pointerup",e);this.shouldIgnoreMove||this.emitter.trigger("dragend",e)};let t=this.pointer=new PointerDragging(e);t.emitter.on("pointerdown",this.handlePointerDown);t.emitter.on("pointermove",this.handlePointerMove);t.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.pointer.destroy()}setIgnoreMove(e){this.shouldIgnoreMove=e}setMirrorIsVisible(e){if(e){if(this.currentMirrorEl){this.currentMirrorEl.style.visibility="";this.currentMirrorEl=null}}else{let e=this.mirrorSelector?document.querySelector(this.mirrorSelector):null;if(e){this.currentMirrorEl=e;e.style.visibility="hidden"}}}}class ThirdPartyDraggable{constructor(e,t){let i=document;if(e===document||e instanceof Element){i=e;t=t||{}}else t=e||{};let n=this.dragging=new InferredElementDragging(i);typeof t.itemSelector==="string"?n.pointer.selector=t.itemSelector:i===document&&(n.pointer.selector="[data-event]");typeof t.mirrorSelector==="string"&&(n.mirrorSelector=t.mirrorSelector);let r=new ExternalElementDragging(n,t.eventData);r.hitDragging.disablePointCheck=true}destroy(){this.dragging.destroy()}}var le=e({name:"@fullcalendar/interaction",componentInteractions:[DateClicking,DateSelecting,EventDragging,EventResizing],calendarInteractions:[UnselectAuto],elementDraggingImpl:FeaturefulElementDragging,optionRefiners:re,listenerRefiners:se});export{ExternalDraggable as Draggable,ThirdPartyDraggable,le as default};

